<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🌍 Cytra Global Music</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap');
    body { margin:0; font-family:'Orbitron',sans-serif; background:#111; color:#fff; display:flex; height:100vh; }
    .sidebar { width:220px; background:#1c1c1c; padding:20px; box-shadow:2px 0 10px rgba(0,0,0,0.5); display:flex; flex-direction:column; transition:width 0.3s ease; }
    .sidebar.collapsed { width:60px; overflow:hidden; }
    .sidebar h2 { color:#ff4081; margin-bottom:20px; white-space:nowrap; }
    .sidebar button { background:none; border:none; color:#fff; font-size:16px; margin-bottom:15px; text-align:left; cursor:pointer; transition:color 0.3s; white-space:nowrap; }
    .sidebar button:hover { color:#ff4081; }
    .toggle-btn { background:none; border:none; color:#ff4081; font-size:24px; margin-bottom:20px; cursor:pointer; align-self:flex-end; }
    .main { flex:1; padding:20px; overflow-y:auto; }
    h1 { color:#ff4081; margin-bottom:20px; text-shadow:0 0 10px rgba(255,64,129,0.7); }
    #search-box { width:90%; max-width:500px; padding:10px; border-radius:8px; border:none; outline:none; margin-bottom:20px; display:none; }
    .track { background:#222; padding:20px; margin:15px auto; border-radius:8px; max-width:700px; box-shadow:0 0 10px rgba(255,64,129,0.4); transition:transform 0.3s; }
    .track:hover { transform:scale(1.03); box-shadow:0 0 20px rgba(255,64,129,0.7); }
    iframe { width:100%; border:none; border-radius:8px; }
    .playlist-btn { background:#ff4081; color:#fff; padding:8px 15px; margin:5px; border:none; border-radius:5px; cursor:pointer; transition:background 0.3s; }
    .playlist-btn:hover { background:#ff77a9; }
    .link { display:block; padding:10px; margin:5px 0; background:#333; border-radius:5px; color:#fff; text-decoration:none; transition:background 0.3s; }
    .link:hover { background:#ff4081; }
  </style>
</head>
<body>
  <div class="sidebar" id="sidebar">
    <button class="toggle-btn" onclick="toggleMenu()">☰</button>
    <h2>🎶 Menu</h2>
    <button onclick="showTab('trending')">🔥 Trending</button>
    <button onclick="showTab('kenya')">🇰🇪 Kenya Top 50</button>
    <button onclick="showTab('dancehall')">💃 Dancehall</button>
    <button onclick="showTab('afrobeat')">🥁 Afrobeat</button>
    <button onclick="showTab('amapiano')">🎹 Amapiano</button>
    <button onclick="showTab('arbantone')">🎶 Arbantone</button>
    <button onclick="showTab('search')">🔍 Search</button>
    <button onclick="showTab('playlist')">📂 Playlist</button>
  </div>

  <div class="main">
    <h1 id="tab-title">🔥 Trending</h1>
    <input type="text" id="search-box" placeholder="Search songs...">
    <div id="results"></div>
  </div>

  <script>
    const results = document.getElementById('results');
    const tabTitle = document.getElementById('tab-title');
    const searchBox = document.getElementById('search-box');
    let playlist = JSON.parse(localStorage.getItem('playlist')||"[]");

    function toggleMenu(){
      document.getElementById('sidebar').classList.toggle('collapsed');
    }

    function showTab(tab){
      searchBox.style.display='none';
      if(tab==='trending'){ showPlaylistEmbed("🔥 Trending (Global)","PLFgquLnL59alCl_2TQvOiD5Vgm1hCaGSI"); }
      if(tab==='kenya'){ showPlaylistEmbed("🇰🇪 Kenya Top 50","PLQog_FHUHAFUXRAPdDtkD0JrLDPAs1wUk"); }
      if(tab==='dancehall'){ showPlaylistEmbed("💃 Dancehall","PLP2fBKY4A2wKS3J6nsR9K3V5h8kp4Y6xF"); }
      if(tab==='afrobeat'){ showPlaylistEmbed("🥁 Afrobeat","PL8fVUTBmJhHJMPzHY5wR1pUpG6lm6lNaM"); }
      if(tab==='amapiano'){ showPlaylistEmbed("🎹 Amapiano","PLM7xQ48sq4kMBmJ8I1M2mA23uok7s1wbx"); }
      if(tab==='arbantone'){ showPlaylistEmbed("🎶 Arbantone","PL7YikJgQ0YpRv3lXjKboiMo4J6ItJuh6e"); }
      if(tab==='search'){ tabTitle.innerText="🔍 Search"; searchBox.style.display='block'; results.innerHTML="<p>Type to search...</p>"; }
      if(tab==='playlist'){ tabTitle.innerText="📂 Playlist"; showPlaylist(); }
    }

    function showPlaylistEmbed(title,playlistId){
      tabTitle.innerText=title;
      results.innerHTML = `
        <div class="track">
          <iframe height="400" src="https://www.youtube.com/embed/videoseries?list=${playlistId}"></iframe>
          <button class="playlist-btn" onclick="downloadMP3('${playlistId}')">Download Playlist (First Track)</button>
        </div>`;
    }

    function searchYouTube(query){
      results.innerHTML = `
        <div class="track">
          <h3>Results for "${query}"</h3>
          <a class="link" href="https://www.youtube.com/results?search_query=${encodeURIComponent(query)}" target="_blank">Open on YouTube</a>
          <button class="playlist-btn" onclick="addToPlaylist('${query}')">Add to Playlist</button>
          <button class="playlist-btn" onclick="downloadMP3ByQuery('${query}')">Download MP3</button>
        </div>`;
    }

    function addToPlaylist(query){
      playlist.push(query);
      localStorage.setItem('playlist', JSON.stringify(playlist));
      alert(`"${query}" added to playlist`);
    }

    function showPlaylist(){
      results.innerHTML = "<h2>Your Playlist</h2>";
      if(!playlist.length){
        results.innerHTML += "<p>No songs yet.</p>";
        return;
      }
      playlist.forEach(item=>{
        results.innerHTML+=`
          <div class="track">
            <h3>${item}</h3>
            <a class="link" href="https://www.youtube.com/results?search_query=${encodeURIComponent(item)}" target="_blank">Play on YouTube</a>
            <button class="playlist-btn" onclick="downloadMP3ByQuery('${item}')">Download MP3</button>
          </div>`;
      });
    }

    async function downloadMP3(videoId){
      try {
        const res = await fetch(`http://localhost:3000/convert?id=${videoId}`);
        const data = await res.json();
        if(data.downloadLink){
          window.open(data.downloadLink,"_blank");
        } else {
          alert("Conversion failed or no link returned.");
        }
      } catch (e) {
        alert("Error: " + e.message);
      }
    }

    async function downloadMP3ByQuery(query){
      alert(`Manual download: Open YouTube for "${query}" and choose video ID to convert.`);
    }

    searchBox.addEventListener('keyup',e=>{
      if(e.target.value.trim().length>2) searchYouTube(e.target.value.trim());
    });

    showTab('trending');
  </script>
</body>
</html>
