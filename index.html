<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸŒ Cytra Global Music</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ff4081">
  <link rel="apple-touch-icon" href="icon-192.png">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap');
    body { margin:0; font-family:'Orbitron',sans-serif; background:#111; color:#fff; display:flex; height:100vh; }
    .sidebar { width:220px; background:#1c1c1c; padding:20px; box-shadow:2px 0 10px rgba(0,0,0,0.5); display:flex; flex-direction:column; transition:width 0.3s ease; }
    .sidebar.collapsed { width:60px; overflow:hidden; }
    .sidebar h2 { color:#ff4081; margin-bottom:20px; white-space:nowrap; }
    .sidebar button { background:none; border:none; color:#fff; font-size:16px; margin-bottom:15px; text-align:left; cursor:pointer; transition:color 0.3s; white-space:nowrap; }
    .sidebar button:hover { color:#ff4081; }
    .toggle-btn { background:none; border:none; color:#ff4081; font-size:24px; margin-bottom:20px; cursor:pointer; align-self:flex-end; }
    .main { flex:1; padding:20px; overflow-y:auto; }
    h1 { color:#ff4081; margin-bottom:20px; text-shadow:0 0 10px rgba(255,64,129,0.7); }
    #search-box { width:90%; max-width:500px; padding:10px; border-radius:8px; border:none; outline:none; margin-bottom:20px; }
    .track { background:#222; padding:20px; margin:15px auto; border-radius:8px; max-width:700px; box-shadow:0 0 10px rgba(255,64,129,0.4); transition:transform 0.3s; }
    .track:hover { transform:scale(1.03); box-shadow:0 0 20px rgba(255,64,129,0.7); }
    audio, iframe { width:100%; margin-top:10px; border:none; }
    .download-btn, .playlist-btn { background:#ff4081; color:#fff; padding:8px 15px; margin-top:10px; display:inline-block; text-decoration:none; border-radius:5px; cursor:pointer; transition:background 0.3s; }
    .download-btn:hover, .playlist-btn:hover { background:#ff77a9; }
  </style>
</head>
<body>
  <div class="sidebar" id="sidebar">
    <button class="toggle-btn" onclick="toggleMenu()">â˜°</button>
    <h2>ğŸ¶ Menu</h2>
    <button onclick="showTab('trending')">ğŸ”¥ Trending</button>
    <button onclick="showTab('search')">ğŸ” Search</button>
    <button onclick="showTab('playlist')">ğŸ“‚ Playlist</button>
    <button onclick="showTab('genres')">ğŸ¼ Genres</button>
    <button onclick="showTab('kenya')">ğŸ‡°ğŸ‡ª Kenya Top 50</button>
    <button onclick="showTab('dancehall')">ğŸ’ƒ Dancehall</button>
    <button onclick="showTab('afrobeat')">ğŸ¥ Afrobeat</button>
    <button onclick="showTab('amapiano')">ğŸ¹ Amapiano</button>
    <button onclick="showTab('arbantone')">ğŸ¶ Arbantone</button>
  </div>
  <div class="main">
    <h1 id="tab-title">ğŸ”¥ Trending</h1>
    <input type="text" id="search-box" placeholder="Search songs..." style="display:none;">
    <div id="genre-container" style="display:none;"></div>
    <div id="results"></div>
  </div>

  <script>
    const CLIENT_ID = "YOUR_SOUNDCLOUD_CLIENT_ID"; // <-- put your SoundCloud client ID
    let playlist = JSON.parse(localStorage.getItem('playlist')||"[]");

    const results = document.getElementById('results');
    const genreContainer = document.getElementById('genre-container');
    const searchBox = document.getElementById('search-box');
    const tabTitle = document.getElementById('tab-title');

    const GENRES = ["Pop","Hip-Hop","EDM","Jazz","Reggae","Afrobeat","Classical","Rock","Trap","Dancehall"];

    function toggleMenu(){
      document.getElementById('sidebar').classList.toggle('collapsed');
    }

    async function loadTrending(){
      results.innerHTML="<p>Loading trending songs...</p>";
      const res = await fetch('https://discoveryprovider.audius.co/v1/tracks/trending?app_name=my_music_app');
      const data = await res.json();
      displayAudiusTracks(data.data,true);
    }

    async function search(query){
      results.innerHTML="<p>Searching...</p>";
      let found=false;

      let audiusRes = await fetch(`https://discoveryprovider.audius.co/v1/tracks/search?query=${encodeURIComponent(query)}&app_name=my_music_app`);
      let audiusData = await audiusRes.json();
      if(audiusData.data.length){
        results.innerHTML="<h2>From Audius</h2>";
        displayAudiusTracks(audiusData.data);
        found=true;
      }

      let scRes = await fetch(`https://api.soundcloud.com/tracks?q=${encodeURIComponent(query)}&client_id=${CLIENT_ID}`);
      let scData = await scRes.json();
      if(scData.length){
        results.innerHTML+="<h2>From SoundCloud</h2>";
        scData.slice(0,3).forEach(track=>{
          results.innerHTML+=`
            <div class="track">
              <h3>${track.title}</h3>
              <audio controls><source src="${track.stream_url}?client_id=${CLIENT_ID}"></audio>
              <button class="playlist-btn" onclick='addToPlaylist("${track.title}","${track.stream_url}?client_id=${CLIENT_ID}")'>Add to Playlist</button>
            </div>`;
        });
        found=true;
      }

      if(!found){
        const ytQuery=encodeURIComponent(query);
        results.innerHTML=`<h2>From YouTube</h2>
          <div class="track">
            <iframe src="https://www.youtube.com/embed?listType=search&list=${ytQuery}" height="300"></iframe>
          </div>`;
      }
    }

    async function loadGenre(genre){
      tabTitle.innerText = `ğŸ¼ ${genre}`;
      results.innerHTML = `<p>Loading ${genre} songs...</p>`;
      const res = await fetch(`https://discoveryprovider.audius.co/v1/tracks/trending?genre=${genre.toLowerCase()}&app_name=my_music_app`);
      const data = await res.json();
      if(data.data.length){
        displayAudiusTracks(data.data,true);
      } else {
        results.innerHTML = `
          <h2>${genre} (YouTube Fallback)</h2>
          <iframe src="https://www.youtube.com/embed?listType=search&list=${encodeURIComponent(genre+' music')}" height="300" width="100%"></iframe>`;
      }
    }

    function displayAudiusTracks(tracks, trending=false){
      tracks.forEach(track=>{
        results.innerHTML+=`
          <div class="track">
            <h3>${track.title} - ${track.user.name}</h3>
            <audio controls><source src="${track.stream_url}?app_name=my_music_app"></audio>
            ${trending?``:`<a href="${track.stream_url}?app_name=my_music_app" download class="download-btn">â¬‡ Download</a>`}
            <button class="playlist-btn" onclick='addToPlaylist("${track.title}","${track.stream_url}?app_name=my_music_app")'>Add to Playlist</button>
          </div>`;
      });
    }

    function addToPlaylist(title,url){
      playlist.push({title,url});
      localStorage.setItem('playlist',JSON.stringify(playlist));
      alert(`${title} added to playlist`);
    }

    function showPlaylist(){
      results.innerHTML="<h2>Your Playlist</h2>";
      if(!playlist.length){
        results.innerHTML+="<p>No songs yet.</p>";
        return;
      }
      playlist.forEach(track=>{
        results.innerHTML+=`
          <div class="track">
            <h3>${track.title}</h3>
            <audio controls><source src="${track.url}"></audio>
          </div>`;
      });
    }

    function showGenres(){
      genreContainer.innerHTML = GENRES.map(g=>`<button class="playlist-btn" onclick="loadGenre('${g}')">${g}</button>`).join(' ');
      genreContainer.style.display='block';
      results.innerHTML = "<p>Select a genre above</p>";
    }

    function showKenyaTop50(){
      tabTitle.innerText = "ğŸ‡°ğŸ‡ª Kenya Top 50";
      results.innerHTML = `
        <h2>Kenya Top 50 (YouTube)</h2>
        <iframe width="100%" height="400" 
          src="https://www.youtube.com/embed?listType=playlist&list=PLFgquLnL59amofQXN0G0hHk4gUYpF5ZC5" 
          frameborder="0" allowfullscreen></iframe>
        <h2>Kenya Trending (Audius Fallback)</h2>
      `;
      fetch("https://discoveryprovider.audius.co/v1/tracks/trending?genre=afrobeat&app_name=my_music_app")
        .then(res => res.json())
        .then(data => { displayAudiusTracks(data.data, true); });
    }

    function showDancehall(){
      tabTitle.innerText = "ğŸ’ƒ Dancehall Trending";
      results.innerHTML = `<p>Loading Dancehall songs...</p>`;
      fetch("https://discoveryprovider.audius.co/v1/tracks/trending?genre=dancehall&app_name=my_music_app")
        .then(res => res.json())
        .then(data => {
          if(data.data.length){ displayAudiusTracks(data.data,true); }
          else { results.innerHTML = `
            <h2>Dancehall (YouTube Fallback)</h2>
            <iframe width="100%" height="300" 
              src="https://www.youtube.com/embed?listType=search&list=Dancehall%20music" 
              frameborder="0" allowfullscreen></iframe>`; }
        });
    }

    function showAfrobeat(){
      tabTitle.innerText = "ğŸ¥ Afrobeat Trending";
      results.innerHTML = `<p>Loading Afrobeat songs...</p>`;
      fetch("https://discoveryprovider.audius.co/v1/tracks/trending?genre=afrobeat&app_name=my_music_app")
        .then(res => res.json())
        .then(data => {
          if(data.data.length){ displayAudiusTracks(data.data,true); }
          else { results.innerHTML = `
            <h2>Afrobeat (YouTube Fallback)</h2>
            <iframe width="100%" height="300" 
              src="https://www.youtube.com/embed?listType=search&list=Afrobeat%20music" 
              frameborder="0" allowfullscreen></iframe>`; }
        });
    }

    function showAmapiano(){
      tabTitle.innerText = "ğŸ¹ Amapiano Trending";
      results.innerHTML = `<p>Loading Amapiano songs...</p>`;
      fetch("https://discoveryprovider.audius.co/v1/tracks/trending?genre=amapiano&app_name=my_music_app")
        .then(res => res.json())
        .then(data => {
          if(data.data.length){ displayAudiusTracks(data.data,true); }
          else { results.innerHTML = `
            <h2>Amapiano (YouTube Fallback)</h2>
            <iframe width="100%" height="300" 
              src="https://www.youtube.com/embed?listType=search&list=Amapiano%20music" 
              frameborder="0" allowfullscreen></iframe>`; }
        });
    }

    function showArbantone(){
      tabTitle.innerText = "ğŸ¶ Arbantone Trending";
      results.innerHTML = `<p>Loading Arbantone songs...</p>`;
      fetch(`https://discoveryprovider.audius.co/v1/tracks/search?query=arbantone&app_name=my_music_app`)
        .then(res => res.json())
        .then(data => {
          if(data.data.length){ displayAudiusTracks(data.data,true); }
          else { results.innerHTML = `
            <h2>Arbantone (YouTube Fallback)</h2>
            <iframe width="100%" height="300" 
              src="https://www.youtube.com/embed?listType=search&list=Arbantone%20music" 
              frameborder="0" allowfullscreen></iframe>`; }
        });
    }

    function showTab(tab){
      results.innerHTML="";
      genreContainer.style.display='none';
      if(tab==='trending'){ tabTitle.innerText="ğŸ”¥ Trending"; searchBox.style.display="none"; loadTrending(); }
      else if(tab==='search'){ tabTitle.innerText="ğŸ” Search"; searchBox.style.display="block"; results.innerHTML="<p>Type to search...</p>"; }
      else if(tab==='playlist'){ tabTitle.innerText="ğŸ“‚ Playlist"; searchBox.style.display="none"; showPlaylist(); }
      else if(tab==='genres'){ tabTitle.innerText="ğŸ¼ Genres"; searchBox.style.display="none"; showGenres(); }
      else if(tab==='kenya'){ searchBox.style.display="none"; showKenyaTop50(); }
      else if(tab==='dancehall'){ searchBox.style.display="none"; showDancehall(); }
      else if(tab==='afrobeat'){ searchBox.style.display="none"; showAfrobeat(); }
      else if(tab==='amapiano'){ searchBox.style.display="none"; showAmapiano(); }
      else if(tab==='arbantone'){ searchBox.style.display="none"; showArbantone(); }
    }

    searchBox.addEventListener('keyup',e=>{ if(e.target.value.trim().length>2) search(e.target.value.trim()); });

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then(reg => console.log('Service Worker registered', reg))
        .catch(err => console.error('SW registration failed', err));
    }

    loadTrending();
  </script>
</body>
</html>

